%---------------
%╔═╗╔═╗╔╦╗╦ ╦╔═╗
%╚═╗║╣  ║ ║ ║╠═╝
%╚═╝╚═╝ ╩ ╚═╝╩  
%---------------

% language setup
\newcommand{\docLanguage}{ngerman}
%\newcommand{\docLanguage}{english}

% DOCUMENT SETUP
\documentclass[12pt, oneside, a4paper, \docLanguage]{report}
\usepackage[left=3cm, 
			right=2.5cm, 
			top=2.5cm, 
			bottom=2.5cm, 
			includehead, 
			includefoot]{geometry}

% line spacing
\usepackage{setspace}
\setstretch{1,25} % 15/12 --> 1.25

% encoding setup
% T1 font encoding for languages that use a latin alphabet
\usepackage[T1]{fontenc} 

% enhanced input encoding handling - utf8 for äÄüÜöÖß...
\usepackage[utf8]{inputenc}

%de­fines Adobe Times Ro­man as de­fault text font
\usepackage{mathptmx}
\usepackage{times} % needed for acronym package

%PDF linking package
\usepackage[hidelinks]{hyperref}


% Language Setup
\usepackage[\docLanguage]{babel}
% after babel - set chapter string
\AtBeginDocument{\renewcommand{\chaptername}{}}

% language specific bibliography style
\usepackage[numbers, square]{natbib}
%\setcitestyle{square,aysep={},yysep={;}}
\usepackage[fixlanguage]{babelbib}
\selectbiblanguage{\docLanguage}
% bliographystyle setup
% babel specific: babplain, babplai3, babalpha, babunsrt, bababbrv, bababbr3
\bibliographystyle{babunsrt}


% enumeration
\usepackage{enumitem}
% tabular extension tabularx
\usepackage{tabularx}

% math packages
\usepackage{amsmath}
\usepackage{nicefrac}
\usepackage{amsthm}
\usepackage{amsbsy}
\usepackage{amssymb}
\usepackage{amsfonts}
%\usepackage{MnSymbol}


%special characters
\usepackage{amssymb}
\usepackage{upgreek,textgreek}

% acronym package
\usepackage[printonlyused, footnote]{acronym}

% breakable text in \seqsplit{}
\usepackage{seqsplit}

% \textmu
\usepackage{textcomp}

% package provides a way to compile sections of a document using the same preamble as the main document
\usepackage{subfiles}

% driver-independent color extension - used by listings,tabularx
\usepackage[usenames,dvipsnames,table,xcdraw]{xcolor}

% -- SYNTAX HIGHLIGHTING --
\usepackage{listings}
%\input{cfgs/listings/listings_def_lang_bash-cmd.tex} % adds style BASH_CMD
%\input{cfgs/listings/listings_def_lang_bash-script.tex} % adds style BASH_SCRIPT
\input{cfgs/listings/listings_def_lang_latex.tex} % adds style LATEX
%\input{cfgs/listings/listings_def_lang_matlab.tex} % adds style MATLAB
\input{cfgs/listings/listings_def_lang_python.tex} % adds style PYTHON
%\input{cfgs/listings/listings_def_lang_c++.tex} % adds style CPP
%\input{cfgs/listings/listings_def_lang_c.tex} % adds style C
%\input{cfgs/listings/listings_def_lang_json.tex} % adds style JSON

% HEADLINE CFG
\usepackage{fancyhdr} % Headers and footers
\usepackage{lastpage}
\usepackage{ifthen}
\setlength{\headheight}{1.5cm}
%\pagestyle{fancy} % All pages have headers and footers
% override plain page style for \part, \chapter or 
% \maketitle, which implicit specifies plain page style
\input{cfgs/fancyhdr/fancyhdr_pagestyle_plain.tex}
% set list pagestyle
\input{cfgs/fancyhdr/fancyhdr_pagestyle_preface.tex}
% set default pagestyle
\input{cfgs/fancyhdr/fancyhdr_pagestyle_default_onepage.tex}
%\input{cfgs/fancyhdr/fancyhdr_pagestyle_default_twopage.tex}

\renewcommand{\chaptermark}[1]{\markright{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}{}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% PICTURE CFG 
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{caption}
\usepackage[list=true,listformat=simple]{subcaption}
% floating prevention packages
\usepackage{float}    % used with [H] positioning parameter
\usepackage{placeins} % \FloatBarrier 
% tikz packages
\usepackage{tikz}
\usepackage{standalone}
\usepackage{pgfplots}


% include only specified tex files - uncommend here
\includeonly{preface/cover,
             preface/abstract,
             preface/tableofcontents,
             preface/listoffigures,
             preface/listoftables,
             preface/lstlistoflistings,
             appendix/bibliography}

%-------------------
%╔═╗╔╦╗╦═╗╦╔╗╔╔═╗╔═╗
%╚═╗ ║ ╠╦╝║║║║║ ╦╚═╗
%╚═╝ ╩ ╩╚═╩╝╚╝╚═╝╚═╝
%-------------------
\newcommand{\strLecture}{Signale, Systeme und Sensoren}
\newcommand{\strDate}{\today}
\newcommand{\strAuthorA}{T. Schoch}
\newcommand{\strAuthorB}{L. Stratmann}
%\newcommand{\strAuthorC}{C. Author}
\newcommand{\strAuthorAEmail}{tobias.schoch@htwg-konstanz.de}
\newcommand{\strAuthorBEmail}{luca.stratmann@htwg-konstanz.de}
%\newcommand{\strAuthorCEmail}{cauthor@htwg-konstanz.de}
% Versuchsbeschreibung 
\newcommand{\strTopic}{Fourieranalyse und Akustik}
\newcommand{\strAbstract}{In dem dritten Versuch der Versuchsreihe werden wir die Fourieranalyse auf akustische Signale und Systeme in Form von Musik durch eine Mundharmonika und Rückkopplung anwenden. Die Signale werden auf einem Oszilloskop angezeigt.
\newline
In den beiden Teilen des Versuchs werden wir akustische Signale mittels der Python Bibliothek TekTDS2000 aufnemmen und abspeichern. Im Anschluss erfolgt mittels Python die Auswertung der Messdaten. 
\newline 
Dabei werden die Techniken der Fouriertransformation und des Bode Diagramms.
}
% hyperref customization
\hypersetup{
	pdftitle     = {\strTopic}, % title
	pdfsubject   = {\strLecture}, % subject of the document
	pdfauthor    = {\strAuthorA, \strAuthorB}, % author
	pdfkeywords  = {}, % list of keywords
	pdfcreator   = {}, % creator of the document
	pdfproducer  = {}, % producer of the document
	colorlinks   = false, % false: boxed links; true: colored links
	linkcolor    = red, % color of internal links (change box color with linkbordercolor)
    citecolor    = green, % color of links to bibliography
    filecolor    = magenta, % color of file links
    urlcolor     = cyan, % color of external links
	%bookmarks    = true, % show bookmarks bar?
	unicode	     = true, % non-Latin characters in Acrobat’s bookmarks
	pdftoolbar   = true, % show Acrobat’s toolbar?
	pdfmenubar   = true, % show Acrobat’s menu?
    pdffitwindow = false, % window fit to page when opened
	pdfnewwindow = true % links in new PDF window
}

%-----------------------------------------
% ╔╗ ╔═╗╔═╗╦╔╗╔  ╔╦╗╔═╗╔═╗╦ ╦╔╦╗╔═╗╔╗╔╔╦╗ 
% ╠╩╗║╣ ║ ╦║║║║   ║║║ ║║  ║ ║║║║║╣ ║║║ ║  
% ╚═╝╚═╝╚═╝╩╝╚╝  ═╩╝╚═╝╚═╝╚═╝╩ ╩╚═╝╝╚╝ ╩  
%-----------------------------------------

\begin{document}
\pagenumbering{Roman} 

\setcounter{section}{0}
\include{preface/cover}

\include{preface/abstract}
\clearpage

%
% TABLE OF CONTENTS
%
\include{preface/tableofcontents}

%
% Abbildungsverzeichnis
%
\include{preface/listoffigures}

%
% Tabellenverzeichnis
%
\include{preface/listoftables}

%
% Listingverzeichnis
%
\include{preface/lstlistoflistings}


%--------------------------
% ╔═╗╦ ╦╔═╗╔═╗╔╦╗╔═╗╦═╗╔═╗ 
% ║  ╠═╣╠═╣╠═╝ ║ ║╣ ╠╦╝╚═╗ 
% ╚═╝╩ ╩╩ ╩╩   ╩ ╚═╝╩╚═╚═╝ 
%--------------------------

\pagenumbering{arabic} 
\setcounter{page}{1} 
\pagestyle{default}
%
% CHAPTER Einleitung
%
\chapter{Einleitung}
\label{chap:EINL}

\cite{Franz2016n}
\cite{Franz2016e}

%
% CHAPTER Versuch 1
%
\chapter{Versuch 1}
\label{chap:VERSUCH_1}

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_1_FRAGESTELLUNG}
Im ersten Versuch der Versuchsreihe "Fourieranalyse und Akustik" werden wir die Fourieranalyse auf akustische Signale und Systeme anwenden.
Dazu werden wir mittels einer Mundharmonika in ein Mikrofon blasen, dass wiederum an ein Oszillskop angeschlossen ist und die Spannungen anzeigt.
Dabei ist es wichtig zu beachten, dass auf dem Oszilloskop mehrere Perioden abgegebildet werden. Das Triggerlevel soll so im Oszilloskop eingestellt werden, dass das Signal nur bei genügend hoher Amplitude eingestellt wird.
Die Triggerung sollte dabei auch im Single Sequence Modus eingestellt werden um statische Daten zu erhalten die auch dem tatsächlichen Spannungswert entsprechen.
Nachdem dies erledigt ist, haben wir ein Pythonskript geschrieben task1.1.py um das Signal aus dem Oszilloskop bei der Einstellung der Triggerung "Single Sequenz" auszulesen.
Dies wird mittels der Toolbox TekTDS2000 von M. Miller in eine .csv Datei gespeichert welche zum Beispiel mit Excel geöffnet werden kann.
\newpage
So sieht der Versuchsaufbau des ersten Versuches aus. Dabei wird das Mikrofon an den Channel 1 des Oszilloskopes angeschlossen. Nach der Kalibrierung und der Einstellung der künstlichen Sinuskurve haben wir mit dem Pythonskript das ausgegebene Signal des Oszilloskopes in eine .csv Datei eingelesen.
Danach hatten wir die Aufgabe folgende Werte zu berechnen.~\par
\begin{itemize}
	\item Grundperiode (in ms)
	\item Grundfrequenz (in Hz)
	\item Signaldauer (in s)
	\item Abtastfrequenz (in Hz)
	\item Signallänge M (Anzahl der Abtastzeitpunkte)
	\item Abtastintervall $\Delta$t (in s)
\end{itemize}
\begin{figure}[H]
	\centering\small
	\includegraphics[width=0.8\textwidth]{media/aufbau2.jpg}
	\caption{Versuchsaufbau Teil 1}
	\label{img:Versuchsaufbau Teil 1}
\end{figure}
\newpage
Im Anschluss mussten wir mithilfe der Funktion numpy.fft.fft() die Fouriertransformation des Signals berechnen. Daraus sollten wir das Amplitudenspektrum bestimmen und graphisch darstellen.
Dabei ist zu beachten, dass die x-Achse mit der Frequenz nicht in Hertz sondern in der Anzahl Schwingungen innerhlab der gesamten Signaldauer definiert ist..
Die Frequenz f in Hertz lässt sich jedoch folgendermaße berechnen.
\\~\\
f = $\dfrac{n}{M * \Delta t}$
\\~\\
Als letzten Teil der ersten Aufgabe sollen wir die Grundfrequenz im Spektrum berechnen und damit die Frequenz in Hertz identifizieren.
Folgende Materialien wurden benötigt: ~\par
\begin{itemize}
	\item Oszilloskop
	\item Mikrofon
	\item Mundharmonika
	\item Signalkabel
	\item Python auf einem Computer
\end{itemize}
\newpage
\section{Messwerte}
\label{chap:VERSUCH_1_MESSWERTE}
Auf dem Bild ist das Signal abgebildet, dass wir mittels einer Mundharmonika in das Mikrofon geblasen haben.
\newline
Durch die Toolbox TekTDS2000 können wir das Signal nun in eine .csv Datei umwandeln und abspeichern.
\newline
Diese Datei haben wir mittels Numpy und der Funktion \textit{np.loadfromtxt} ausgelesen.
Die Ergebnisse wurden in die 2 verschiedene Funktionen x und y geschrieben.
\newline
Danach wurden diese mittels matplotlib graphisch dargestellt.
\begin{figure}[H]
	\centering\small
	\includegraphics[width=0.9\textwidth]{../data/img/mundharmonika.png}
	\caption{Signal einer Mundharmonika}
	\label{img:Signal einer Mundharmonika}
\end{figure}
\newpage
\section{Auswertung}
\label{chap:VERSUCH_1_AUSWERTUNG}
Auf dem Spannungsverlauf sieht man das aufgenommene Signal der Mundharmonika.
Durch einen Pythonfunktion die wir aus der Toolbox TekTDS2000 erhalten haben, konnten wir den Spannungsverlauf aus dem Oszilloskop einlesen und in eine .csv Datei schreiben.
\newline
Dieses Format wird auch häufig für Excel Dateien verwendet.
Durch das Drücken des Knopfes Single Sequence haben wir auf dem Oszilloskop ein Standbild erhalten.
\newline
Diese Datei haben wir mittels Numpy und der Funktion \textit{np.loadfromtxt} ausgelesen.
Die Ergebnisse wurden in die 2 verschiedene Funktionen x und y geschrieben.
\newline
Danach wurden diese mittels matplotlib graphisch dargestellt.
\\~\\
Die Grundperiode und die Grundfrequenz haben wir uns mittels der Toolbox TekTDS2000 durch getFreq(1) und getPeriod(1) ausgeben lassen.
Die Signallänge M haben wir durch \textit{len(file.readlines())} erfahren.
\newline 
Durch die absolute Addition von den beiden Maxima- und Minimawerten erhalten wir gerundet die Signaldauer.
Wenn man nun die Signaldauer dividiert durch die Signallänge erhält man das Abtastintervall $\Delta$t mit dem Wert 4µs.
\newline
Mit dem Abtastintervall erhält man auch die Abtastfrequenz. Diese entspricht 250000  Hertz.
Im folgenden sind die Ergebnisse der Berechnungen aufzufinden:
\begin{table}[H]
	\centering\small
	\begin{tabular}{|c|c|}
	\hline
	Plot & Wert \\
	\hline
	Grundperiode (in ms) & 1.275ms \\
	\hline
	Grundfrequenz (in Hertz) & 784.31Hz \\
	\hline
	Signaldauer &  0,01s\\
	\hline
	Abtastfrequenz (in Kilohertz) &  250KHz\\
	\hline
	Signallänge M (Anzahl der Abtastzeitpunkte) & 2500 \\
	\hline
	Abtastintervall $\Delta$t (in µs) & 4µs \\
	\hline
	\end{tabular}
	\caption{Zu berechnende Werte}
	\label{fig:VERSUCH_1_MESSWERTE}
\end{table}
\newpage
Das Amplitudenspektrum erhält man indem man die Spannung absolut fouriertransformiert mit der Numpy Funktion \textit{np.fft.fft()} und als Amplitude auf der y Achse ausgibt. 
\newline
Doch bisher wird die x-Achse in der Einheit \textit{Anzahl Schwingungen innerhalb der gesamten Signaldauer} und nicht in Hertz angegeben. 
\newline
Um dies jedoch zu tun müssen wir die Frequenz in f folgendermaßen berechnen:
\\~\\
f = $\dfrac{n}{M * \Delta t}$
\\~\\
Die jeweilige Schwingung n wird geteilt durch die Signallänge und das Abtastintervall.
Dadurch erhält man folgenden Graphen, welcher bis zu dem von uns festgelegten Frequenzwert von 20000 geplotet wird.
\begin{figure}[H]
	\centering\small
	\includegraphics[width=0.8\textwidth]{../data/img/mundharmonika2.png}
	\caption{Das Amplitudenspekktrum von der Fourieranalyse}
	\label{img:Das Amplitudenspekktrum von der Fourieranalyse}
\end{figure}
\newpage
Mittels der Numpy Funktion \textit{np.max(spektrum)} können wir den maximalen Amplitudenwert abfragen.
Mittels einer for-Schleife fragen wir nun den Wert bis zum 1250sten Signal ab der das Maxima hat.
\newline 
Dadurch erhalten wir die Frequenz des maximalen Amplitudenwerts.
Wir fragen genau bis zur Hälfte der Werte ab, da der Graph sich spiegelt und es so 2 Maxima gibt. Da wir nur den ersten Wert wollen müssen wir dies festlegen.
\newline
Im folgenden sind die Ergebnisse der Berechnungen aufzufinden:
\begin{table}[H]
	\centering\small
	\begin{tabular}{|c|c|}
	\hline
	Plot & Wert \\
	\hline
	Maximaler Amplitudenwert & 4.5675 \\
	\hline
	Frequenz des Maxima & 800Hz \\
	\hline
	\end{tabular}
	\caption{Zu berechnende Werte}
	\label{fig:VERSUCH_1_MESSWERTE}
\end{table}
\newpage
\section{Interpretation}
\label{chap:VERSUCH_1_INTERPRETATION}
Da das Signal der Mundharmonika schön gleichmäßig ist, kann man feststellen, dass der Ton sehr gleichmäßig gespielt wurde. 
\newline 
Durch die Beschaffenheit des Funktionsweise und die laute Gegebenheiten zum Zeitpunkt der Messung, kann man gut beobachten, dass die Amplitude nach so gut wie jeder periodischen Wiederholung zunimmt und damit die Spannung auch höher wird.
Im großen Ganzen jedoch gibt es keine Unstimmigkeiten.
\\~\\
Für die Tabelle 2.1 kann man folgende Schlussfolgerungen ziehen: ~\par
\begin{itemize}
	\item Die Signaldauer ist komplementär mit der Signallänge und der dem Abtastintervall
	\item Das Abtastintervall ist komplementär zur Abtastfrequenz
	\item Frequenz und Zeit sind komplementär zueinander
\end{itemize}
\\~\\
Bei der Abbildung 2.3 ist eine schöne Amplitude zu erkennen, die sich von den anderen Amplituden durch ihre Höhe absetzt.
Dieser maximale Amplitudenausschlag mit der Höhe 4.5675V ist der Ton.
\newline 
Der Ton den wir produziert haben liegt also demnach bei 800Hz. Da wir bis auf eine Öffnung die Anderen zugeklebt haben, wissen wir dass wir einen Ton mit der Frequenz von 800Hz gespielt haben. 
\newline
Die anderen kleinen Harmonischen sind die Obertöne.
Wir wissen durch das Amplitudenspektrum auch, dass wir keinen Klang gespielt haben und die Mundharmonika richtig zugeklebt haben.
\\~\\
Wenn man die Fouriertransformierte für alle 2500 Abtastungen graphisch darstellt, dann stellt sich eine y-Achsenspiegelung dar.
Da wir jedoch keine Achsenspiegelung wollen sondern ledigliche bis Frequenzen von 20000Hz kürzen wir die x-Achse um nur die wichtigen Werte zu erlangen.
%
% CHAPTER Versuch 2
%
\chapter{Versuch 2}
\label{chap:VERSUCH_2}

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_2_FRAGESTELLUNG}

\section{Messwerte}
\label{chap:VERSUCH_2_MESSWERTE}
\begin{figure}[H]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.9\linewidth]{../data/img/100.png}
  \caption{Die Ausgabe des Oszilloskopes}
  \label{fig:Die Ausgabe des Oszilloskopes}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.9\linewidth]{../data/img/gross100.png}
  \caption{Die Auswertung der .csv Datei durch Python}
  \label{fig:Die Auswertung der .csv Datei durch Python}
\end{subfigure}
\caption{Einlesen des Signals in .csv und duch das Oszilloskop}
\label{fig:Einlesen des Signals in .csv und duch das Oszilloskop}
\end{figure}

\section{Auswertung}
\label{chap:VERSUCH_2_AUSWERTUNG}

\section{Interpretation}
\label{chap:VERSUCH_2_INTERPRETATION}

%
% CHAPTER Anhang
%
\renewcommand\thesection{A.\arabic{section}}
\renewcommand\thesubsection{\thesection.\arabic{subsection}}

\chapter*{Anhang}
\label{chap:APPENDIX}
\addcontentsline{toc}{chapter}{Anhang}
%\setcounter{chapter}{0}
\addtocounter{chapter}{1}
\setcounter{section}{0}

\section{Quellcode}
\label{chap:APPENDIX_SOURCECODE}

\subsection{Quellcode Versuch 1.1}
\label{chap:APPENDIX_SOURCECODE_V1.1}
\lstinputlisting[style=PYTHON, frame=single, caption=Das Bild des Oszilloskopes einlesen und abspeichern, captionpos=b, label=lst:APPENDIX_SOURCECODE_AREA1]{../task1.1.py}
\newpage
\subsection{Quellcode Versuch 1.2}
\label{chap:APPENDIX_SOURCECODE_V1.2}
\lstinputlisting[style=PYTHON, frame=single, caption=.csv Datei einlesen und in einem Plot graphisch wiedergeben, captionpos=b, label=lst:APPENDIX_SOURCECODE_AREA1]{../task1.2.py}
\subsection{Quellcode Versuch 1.3}
\label{chap:APPENDIX_SOURCECODE_V1.3}
\lstinputlisting[style=PYTHON, frame=single, caption=Fouriertransformation anwenden und ein Amplitudenspektrum ausgeben  sowie Berechnung einiger Werte, captionpos=b, label=lst:APPENDIX_SOURCECODE_AREA1]{../task1.3.py}
\newpage
\subsection{Quellcode Versuch 2.1}
\label{chap:APPENDIX_SOURCECODE_V2.1}
\lstinputlisting[style=PYTHON, frame=single, caption=Lautsprecherdaten graphisch ausgeben und einige Werte berechnen, captionpos=b, label=lst:APPENDIX_SOURCECODE_AREA1]{../task2.1.py}
\newpage
\subsection{Quellcode Versuch 2.2}
\label{chap:APPENDIX_SOURCECODE_V2.2}
\lstinputlisting[style=PYTHON, frame=single, caption=Amplitude\, Phasenverschiebung und Bode-Diagramm berechnen, captionpos=b, label=lst:APPENDIX_SOURCECODE_AREA1]{../task2.2.py}
\newpage
\section{Messergebnisse}
\label{chap:APPENDIX_MEASUREMENT_SOURCE}
\begin{figure}[H]
	\centering\small
	\includegraphics[width=0.9\textwidth]{media/mess.png}
	\caption{Messergebnisse für Task 2}
	\label{img:Messergebnisse für Task 2}
\end{figure}
%
% Literaturverzeichnis
%
\include{appendix/bibliography}

\end{document}
%------------------------------------
% ╔═╗╔╗╔╔╦╗  ╔╦╗╔═╗╔═╗╦ ╦╔╦╗╔═╗╔╗╔╔╦╗
% ║╣ ║║║ ║║   ║║║ ║║  ║ ║║║║║╣ ║║║ ║ 
% ╚═╝╝╚╝═╩╝  ═╩╝╚═╝╚═╝╚═╝╩ ╩╚═╝╝╚╝ ╩ 
%------------------------------------